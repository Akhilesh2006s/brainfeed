(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{54446:(e,t,s)=>{Promise.resolve().then(s.bind(s,68577))},68577:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>W});var a=s(82901),l=s(94065),r=s(54048),i=s(22406),d=s(80593),c=s(81363),n=s(93235),h=s(76929),x=s(60284),o=s(84019),j=s(48544),m=s(30933),u=s(12838),w=s(68181),g=s(63466),p=s(52401),b=s(13355),v=s(61833),k=s(99372),N=s(72583),f=s(52868),A=s(40989),y=s(20678),C=s(68427),B=s(62748),Z=s(30479),S=s(28238),E=s(39758),I=s(86053);function W(){let e=(0,i.useRouter)(),{toast:t}=(0,o.dj)(),[s,W]=(0,l.useState)(null),[R,F]=(0,l.useState)(!0),[T,H]=(0,l.useState)([]),[D,O]=(0,l.useState)([]),{data:P,isLoading:L}=(0,r.I)({queryKey:["/api/admin/analytics"],queryFn:async()=>{let e=await fetch("/api/admin/analytics?days=30");if(!e.ok)throw Error("Failed to fetch analytics");return e.json()}});(0,l.useEffect)(()=>{X()},[]);let X=async()=>{try{let t=await fetch(I.FH.auth.me.path);if(!t.ok)return void e.push("/login");let s=await t.json();if("admin"!==s.role)return void("writer"===s.role?e.push("/writer/dashboard"):e.push("/login"));W(s),await _()}catch(t){e.push("/login")}finally{F(!1)}},_=async()=>{try{let e=await fetch("".concat(I.FH.articles.list.path,"?status=pending")),t=await e.json();H(t);let s=await fetch(I.FH.articles.list.path),a=await s.json();O(a)}catch(e){t({title:"Error",description:"Failed to fetch articles",variant:"destructive"})}},K=async(e,s)=>{try{let a=await fetch("/api/articles/".concat(e,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})}),l=await a.json();a.ok?(t({title:"Success",description:l.message}),await _()):t({title:"Error",description:l.message||"Failed to update article status",variant:"destructive"})}catch(e){t({title:"Error",description:"An error occurred",variant:"destructive"})}},$=async()=>{try{await fetch(I.FH.auth.logout.path,{method:"POST"}),e.push("/login")}catch(e){console.error("Logout error:",e)}},q=Object.values(D.reduce((e,t)=>(t.writerId&&(e[t.writerId]||(e[t.writerId]={writerId:t.writerId,totalArticles:0,totalClicks:0,approvedArticles:0}),e[t.writerId].totalArticles++,e[t.writerId].totalClicks+=t.clicks,"approved"===t.status&&e[t.writerId].approvedArticles++),e),{})).sort((e,t)=>t.totalClicks-e.totalClicks),z=P?Object.entries(P.eventBreakdown).map(e=>{let[t,s]=e;return{name:t,value:s}}):[],M=["#0066CC","#00B8A9","#1A3B52","#FF6B6B","#4ECDC4"];return R||L?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(f.A,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-900 dark:text-white",children:"Loading..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-4 md:p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Admin Dashboard"}),(0,a.jsxs)("p",{className:"text-slate-600 dark:text-slate-400",children:["Welcome back, ",null==s?void 0:s.name,"!"]})]}),(0,a.jsxs)(c.$,{variant:"outline",onClick:$,className:"w-full sm:w-auto border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800",children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Logout"]})]}),P&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Sessions"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-slate-400 dark:text-slate-500"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:P.totalSessions})})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Events"}),(0,a.jsx)(C.A,{className:"h-4 w-4 text-slate-400 dark:text-slate-500"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:P.totalEvents})})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Pending Articles"}),(0,a.jsx)(B.A,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-500"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:T.length})})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Clicks"}),(0,a.jsx)(Z.A,{className:"h-4 w-4 text-blue-600 dark:text-blue-500"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:D.reduce((e,t)=>e+t.clicks,0)})})]})]}),(0,a.jsxs)(n.tU,{defaultValue:"pending",className:"space-y-4",children:[(0,a.jsxs)(n.j7,{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[(0,a.jsxs)(n.Xi,{value:"pending",className:"data-[state=active]:bg-slate-100 dark:data-[state=active]:bg-slate-800 data-[state=active]:text-slate-900 dark:data-[state=active]:text-white",children:["Pending Approval (",T.length,")"]}),(0,a.jsx)(n.Xi,{value:"writers",className:"data-[state=active]:bg-slate-100 dark:data-[state=active]:bg-slate-800 data-[state=active]:text-slate-900 dark:data-[state=active]:text-white",children:"Writer Analytics"}),(0,a.jsx)(n.Xi,{value:"analytics",className:"data-[state=active]:bg-slate-100 dark:data-[state=active]:bg-slate-800 data-[state=active]:text-slate-900 dark:data-[state=active]:text-white",children:"Overall Analytics"})]}),(0,a.jsx)(n.av,{value:"pending",children:(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"Articles Pending Approval"}),(0,a.jsx)(d.BT,{className:"text-slate-600 dark:text-slate-400",children:"Review and approve or reject articles submitted by writers"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Title"}),(0,a.jsx)(h.nd,{children:"Author"}),(0,a.jsx)(h.nd,{children:"Category"}),(0,a.jsx)(h.nd,{children:"Submitted"}),(0,a.jsx)(h.nd,{children:"Actions"})]})}),(0,a.jsx)(h.BF,{children:0===T.length?(0,a.jsx)(h.Hj,{children:(0,a.jsx)(h.nA,{colSpan:5,className:"text-center text-muted-foreground",children:"No pending articles"})}):T.map(e=>(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{className:"font-medium",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.excerpt.substring(0,80),"..."]})]})}),(0,a.jsx)(h.nA,{children:e.author.name}),(0,a.jsx)(h.nA,{children:e.category.name}),(0,a.jsx)(h.nA,{children:new Date(e.publishedAt).toLocaleDateString()}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.$,{size:"sm",variant:"default",onClick:()=>K(e.id,"approved"),children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,a.jsxs)(c.$,{size:"sm",variant:"destructive",onClick:()=>K(e.id,"rejected"),children:[(0,a.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},e.id))})]})})]})}),(0,a.jsx)(n.av,{value:"writers",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"Writer Performance"}),(0,a.jsx)(d.BT,{className:"text-slate-600 dark:text-slate-400",children:"See which writers are getting the most engagement"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Writer ID"}),(0,a.jsx)(h.nd,{children:"Total Articles"}),(0,a.jsx)(h.nd,{children:"Approved"}),(0,a.jsx)(h.nd,{children:"Total Clicks"}),(0,a.jsx)(h.nd,{children:"Avg Clicks/Article"})]})}),(0,a.jsx)(h.BF,{children:0===q.length?(0,a.jsx)(h.Hj,{children:(0,a.jsx)(h.nA,{colSpan:5,className:"text-center text-muted-foreground",children:"No writer data available"})}):q.map(e=>(0,a.jsxs)(h.Hj,{children:[(0,a.jsxs)(h.nA,{children:["Writer ",e.writerId]}),(0,a.jsx)(h.nA,{children:e.totalArticles}),(0,a.jsx)(h.nA,{children:e.approvedArticles}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(Z.A,{className:"mr-1 h-4 w-4"}),e.totalClicks]})}),(0,a.jsx)(h.nA,{children:e.totalArticles>0?Math.round(e.totalClicks/e.totalArticles):0})]},e.writerId))})]})})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"Top Content by Clicks"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Title"}),(0,a.jsx)(h.nd,{children:"Category"}),(0,a.jsx)(h.nd,{children:"Status"}),(0,a.jsx)(h.nd,{children:"Clicks"})]})}),(0,a.jsx)(h.BF,{children:D.sort((e,t)=>t.clicks-e.clicks).slice(0,10).map(e=>{var t;return(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{className:"font-medium",children:e.title}),(0,a.jsx)(h.nA,{children:e.category.name}),(0,a.jsx)(h.nA,{children:(t=e.status,(0,a.jsx)(x.E,{variant:{pending:"secondary",approved:"default",rejected:"destructive"}[t]||"outline",children:t}))}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(Z.A,{className:"mr-1 h-4 w-4"}),e.clicks]})})]},e.id)})})]})})]})]})}),(0,a.jsx)(n.av,{value:"analytics",children:P&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"Top Articles by Views"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(j.u,{width:"100%",height:300,children:(0,a.jsxs)(m.E,{data:P.topArticles,children:[(0,a.jsx)(u.d,{strokeDasharray:"3 3"}),(0,a.jsx)(w.W,{dataKey:"title",angle:-45,textAnchor:"end",height:80}),(0,a.jsx)(g.h,{}),(0,a.jsx)(p.m,{}),(0,a.jsx)(b.y,{dataKey:"views",fill:"#0066CC"})]})})})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"Event Breakdown"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(j.u,{width:"100%",height:300,children:(0,a.jsxs)(v.r,{children:[(0,a.jsx)(k.F,{data:z,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,value:s}=e;return"".concat(t,": ").concat(s)},outerRadius:80,fill:"#8884d8",dataKey:"value",children:z.map((e,t)=>(0,a.jsx)(N.f,{fill:M[t%M.length]},"cell-".concat(t)))}),(0,a.jsx)(p.m,{})]})})})]})]}),(0,a.jsxs)(d.Zp,{className:"border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-lg",children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-slate-900 dark:text-white",children:"User Behavior Insights"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Average Scroll Depth"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[P.userBehavior.scrollDepthAvg,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Chat Sessions"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:P.chatEngagement.totalChats})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Chat Engagement Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[P.totalSessions>0?Math.round(P.chatEngagement.totalChats/P.totalSessions*100):0,"%"]})]})]})})]})]})})]})]})})}}},e=>{e.O(0,[721,430,663,48,342,666,800,552,544,659,358],()=>e(e.s=54446)),_N_E=e.O()}]);